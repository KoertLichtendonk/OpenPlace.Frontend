import"../chunks/B2cHk4HI.js";import{o as Rt}from"../chunks/4WsUhDWi.js";import{at as Lt,p as Ct,au as Q,av as be,f as w,s,t as U,b,c as Bt,g as e,aw as x,$ as St,d as t,r as a,u as X,az as Mt,a as Z,ay as Ze,n as qe,b4 as Fe}from"../chunks/BDALf20I.js";import{s as l}from"../chunks/4k6DpCgf.js";import{i as T}from"../chunks/Bke_korE.js";import{a as Dt,k as Pt}from"../chunks/BCONGQnO.js";import{e as He,i as jt}from"../chunks/CZW2bcQi.js";import{h as Nt}from"../chunks/BUhRjcOt.js";import{s as G,a as H,c as Et,d as Ot}from"../chunks/BNZUboE0.js";import{g as Gt}from"../chunks/B4HM4TqG.js";import{p as Je}from"../chunks/C-Y7nmnD.js";import{a as le,t as W,u as Ke,s as F,b as Wt}from"../chunks/DffDvEhl.js";import{P as Qe}from"../chunks/DCxPsWiR.js";import{A as Vt}from"../chunks/CVCd3urP.js";import{C as Ba,T as Yt,G as qt,c as Ft}from"../chunks/ZzI7cLBE.js";import{L as Xe,d as Ht,p as Jt}from"../chunks/sZ1mzRzK.js";import{r as Sa,n as Kt,M as Qt,a as Xt,b as Zt,c as es,t as as,d as ts,l as ss,e as rs,f as ns,g as os,h as is,m as ls,i as cs,j as ds,u as vs,k as _s}from"../chunks/5mOJ66sL.js";import{R as Ma}from"../chunks/rLj4C5Bn.js";import{g as xe}from"../chunks/DklPLC_x.js";import{r as ps}from"../chunks/Drv8f_fG.js";import{t as us,f as fs}from"../chunks/DS5O-Inb.js";import{o as ms}from"../chunks/GVP1MJz5.js";import{g as ge,a as bs}from"../chunks/ClOhzjRc.js";(function(){try{var p=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};p.SENTRY_RELEASE={id:"35111e7039e8c68cc677344b7f7c6971567f6820"}}catch{}})();try{(function(){var p=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},c=new p.Error().stack;c&&(p._sentryDebugIds=p._sentryDebugIds||{},p._sentryDebugIds[c]="e37f7fef-8481-48d3-ae18-a18771d129a0",p._sentryDebugIdIdentifier="sentry-dbid-e37f7fef-8481-48d3-ae18-a18771d129a0")})()}catch{}const gs=()=>"Ignore",xs=()=>"Ignorar",hs=(p={},c={})=>(c.locale??xe())==="en"?gs():xs(),ys=()=>"Ignore all",ks=()=>"Ignorar todos",ws=(p={},c={})=>(c.locale??xe())==="en"?ys():ks(),Pa=()=>"Ban",$s=Pa,Ts=(p={},c={})=>(c.locale??xe())==="en"?Pa():$s(),Us=()=>"Closed tickets",Is=()=>"Tickets fechados",zs=(p={},c={})=>(c.locale??xe())==="en"?Us():Is(),Da=(p,c=Mt)=>{var d=As();let k;var f=t(d);{var ce=g=>{var Y=Fe("MOD");b(g,Y)},V=g=>{var Y=Ze(),I=Z(Y);{var he=M=>{var D=Fe("GM");b(M,D)},de=M=>{var D=Fe("ADMIN");b(M,D)};T(I,M=>{c()==="global_moderator"?M(he):M(de,!1)},!0)}b(g,Y)};T(f,g=>{c()==="moderator"?g(ce):g(V,!1)})}a(d),U(g=>k=H(d,1,"badge badge-sm ml-0.5 font-semibold",null,k,g),[()=>({"badge-secondary":c()==="moderator"||c()=="global_moderator","badge-warning":c()==="admin"})]),b(p,d)};var As=w("<span><!></span>"),Rs=(p,c)=>{c()},Ls=(p,c,d)=>{x(c,e(d),!0)},Cs=w('<div class="absolute bottom-5 right-5"><!></div>'),Bs=w('<button><!> <div class="flex flex-col text-start"><span><span> </span> <span> </span></span> <span class="text-base-content/80 text-sm font-medium"> </span></div> <!></button>'),Ss=async(p,c,d,k)=>{await c(),x(d,e(k)[0],!0)},Ms=w('<p class="text-base-content/80"> </p> <button class="btn btn-primary btn-sm"><!> </button>',1),Ds=w('<span class="loading loading-spinner loading-md"></span>'),Ps=(p,c)=>{navigator.clipboard.writeText(e(c).reportedUser.id.toString()),W.success(vs())},js=(p,c)=>{navigator.clipboard.writeText(e(c).toString()),W.success(_s())},Ns=w("<button> <!></button>"),Es=w('<span class="tooltip tooltip-bottom badge bg-green-600 text-green-100" data-tip="User has spent money on Wplace">ðŸ’° PAID</span>'),Os=w('<span> <span class="font-semibold"> </span></span> <span> <span class="font-semibold"> </span></span>',1),Gs=(p,c,d)=>{c(e(d).id)},Ws=w('<button class="btn ml-auto"> </button>'),Vs=(p,c,d,k)=>{c(e(d).id,e(k).id)},Ys=(p,c,d,k)=>{c(e(d).id,e(k))},qs=(p,c,d,k)=>{c(e(d).id,e(k))},Fs=w('<button class="btn btn-error"><!> </button>'),Hs=w("<option> </option>"),Js=w('<div><h4 class="font-semibold"> </h4> <p class="text-base-content/80 text-sm"> </p></div>'),Ks=w('<iframe class="border-base-content/20 touchscreen:hidden h-[75vh] w-[90%] border" title="Report image" loading="lazy"></iframe>'),Qs=(p,c,d)=>{c[e(d).id]={showIframe:!0}},Xs=w('<button class="btn btn-primary btn-lg"><!> View live</button>'),Zs=w('<div class="flex flex-col gap-3"><h4 class="text-primary flex items-center justify-between text-xl font-semibold"> <div class="flex gap-2"><button class="btn"> </button> <button class="btn btn-error"><!> </button> <!></div></h4> <div class="flex gap-3"><!> <div><span class="text-lg"> <span><span> </span> <span> </span></span></span> <div class="flex flex-col text-sm"><div class="mt-1 flex items-center gap-2"><span class="text-base"> </span> <select></select></div> <span class="mt-1"> <span class="font-semibold"> </span></span> <span> <a target="_blank"><!> <span class="link">Link</span></a></span> <span> <a target="_blank"><!> <span class="link">Link</span></a></span></div></div></div> <!> <div class="flex flex-col items-center justify-center gap-4"><a class="relative h-max w-max" title="Report location" target="_blank"><img class="border-base-content/20 mx-auto max-h-[70vh] w-max border" alt="Report location"/> <!></a> <!></div></div>'),er=w('<header class="bg-base-100 sticky top-0 z-10 flex items-center justify-between px-6 pb-4 pt-6"><h3 class="text-xl font-semibold"> </h3></header> <div class="px-6 pb-8"><section class="flex gap-3"><!> <div><span class="text-lg"><span> </span>: <span><span> </span> <span> </span> <button><!></button> <!> <!></span> <!></span> <div class="flex flex-col text-sm"><span> <span class="font-semibold"> </span></span> <!> <span> <span class="font-semibold"> </span></span> <span> <span> </span></span></div></div> <!></section> <span class="divider"></span> <section class="mt-6 flex flex-col gap-4"></section></div>',1),ar=w('<div class="bg-base-200 grid h-full grid-cols-[350px_1fr] gap-4 p-4"><section class="flex flex-col gap-3 overflow-auto px-1 pb-1"><div class="mb-4 flex items-center justify-between"><div class="flex items-center gap-1"><a class="btn btn-ghost btn-circle"><!></a> <span class="relative flex flex-col items-start"><h2 class="text-xl font-semibold"> </h2> <span class="text-base-content/80 -bottom-4.5 absolute text-sm"> </span> <span class="tooltip tooltip-bottom text-base-content/80 text-sm before:translate-x-1/4"><div class="tooltip-content rounded-xl text-left"> <br/> <br/> <br/> </div> </span></span></div> <button class="btn btn-circle btn-sm"><!></button></div> <!> <div class="mt-10 flex flex-col items-center justify-center gap-2"><!></div></section> <section class="rounded-box bg-base-100 overflow-auto shadow"><!></section></div>');function Tr(p,c){Ct(c,!0);let d=Q(!0),k=Q(!1),f=Q(be([])),ce=Q(void 0),V=Q(be({closedTotal:0,bans:0,ignored:0,timeouts:0,rclosedTotal:0,rignored:0,rtimeouts:0,rbans:0})),g=Q(void 0),Y=be({}),I=Q(be({}));const he=[{value:"griefing",label:F.griefing},{value:"inappropriate-content",label:F["inappropriate-content"]},{value:"hate-speech",label:F["hate-speech"]},{value:"doxxing",label:F.doxxing},{value:"multi-accounting",label:F["multi-accounting"]},{value:"bot",label:F.bot},{value:"other",label:F.other}];Rt(()=>{de()});async function de(){await M(),e(f).length<=1&&await D(),e(g)||x(g,e(f)[0],!0)}async function M(){try{x(d,!0);const i=await le.getModeratorTickets();x(f,i.tickets,!0),ea();try{x(V,await le.countMyTicketsClosedToday(),!0)}catch(n){return W.error(n.message),{closedTotal:0,ignored:0,timeouts:0,bans:0,rclosedTotal:0,rignored:0,rtimeouts:0,rbans:0}}x(I,{},!0);for(const n of e(f))for(const _ of n.reports)e(I)[_.id]=_.assignedReason??_.reason}catch(i){i.status===403||i.status===401?Gt("/404"):W.error(i.message)}finally{x(d,!1)}}async function D(){try{x(d,!0);const{newTicketsIds:i}=await le.assignNewTickets();i.length>0&&await M(),await ea()}catch(i){W.error(i.message)}finally{x(d,!1)}}async function ea(){try{x(ce,await le.getNonPaidUserOpenTicketsCount(),!0)}catch(i){W.error(i.message)}}async function ve(i,n,_,$){try{x(k,!0),await le.setTicketStatus(i,n,_,$),n!=="open"&&!(n==="ignore"&&_)&&(x(f,e(f).filter(r=>r.id!==i),!0),e(f).length<=1&&await D(),x(g,e(f)[0],!0))}catch(r){W.error(r.message)}finally{x(k,!1)}}function ja(i){return ve(i,"ignore",0,"other").then(()=>{x(f,e(f).filter(n=>n.id!==i),!0),x(g,e(f)[0],!0),e(f).length<=1&&D()}).catch(n=>{W.error(n.message)})}function Na(i,n){return ve(i,"ignore",n,e(I)[n]??"other").then(()=>{const _=e(f).findIndex(r=>r.id===i);if(_===-1)return;const $=e(f)[_];if($.reports=$.reports.filter(r=>r.id!==n),delete e(I)[n],delete Y[n],$.reports.length===0){x(f,e(f).filter(r=>r.id!==i),!0),x(g,e(f)[0],!0),e(f).length<=1&&D();return}x(g,{...$},!0)}).catch(_=>{W.error(_.message)})}function Ea(i,n){const _=e(I)[n.id]??n.assignedReason??n.reason;return ve(i,"timeout",n.id,_)}function Oa(i,n){const _=e(I)[n.id]??n.assignedReason??n.reason;return ve(i,"ban",n.id,_)}var ye=ar();Nt(i=>{St.title="Wplace - Moderation"});var ke=t(ye),we=t(ke),$e=t(we),_e=t($e),Ga=t(_e);Vt(Ga,{class:"size-5"}),a(_e);var aa=s(_e,2),Te=t(aa),Wa=t(Te,!0);a(Te);var Ue=s(Te,2),Va=t(Ue);a(Ue);var ta=s(Ue,2),Ie=t(ta),sa=t(Ie),ra=s(sa,2),na=s(ra,2),Ya=s(na,2);a(Ie);var qa=s(Ie);a(ta),a(aa),a($e);var pe=s($e,2);pe.__click=[Rs,de];var Fa=t(pe);Ma(Fa,{class:"size-4"}),a(pe),a(we);var oa=s(we,2);He(oa,25,()=>e(f),i=>i.id,(i,n)=>{const _=X(()=>new Date(e(n).createdAt)),$=X(()=>{var L;return((L=e(g))==null?void 0:L.id)===e(n).id});var r=Bs();r.__click=[Ls,g,n];var A=t(r);Qe(A,{class:"size-13",get userId(){return e(n).reportedUser.id},get pictureUrl(){return e(n).reportedUser.picture}});var q=s(A,2),R=t(q),P=t(R),ze=t(P,!0);a(P);var ee=s(P,2),ae=t(ee);a(ee),a(R);var te=s(R,2),se=t(te,!0);a(te),a(q);var re=s(q,2);{var ne=L=>{var C=Cs(),oe=t(C);Da(oe,()=>e(n).reportedUser.role),a(C),b(L,C)};T(re,L=>{e(n).reportedUser.role!=="user"&&L(ne)})}a(r),U((L,C)=>{H(r,1,Et({"bg-base-100 ring-primary relative flex gap-2 rounded-2xl p-4 shadow":!0,"bg-primary/10 ring-2":e($)})),H(R,1,`text-lg font-semibold ${L??""} flex gap-1.5`),l(ze,e(n).reportedUser.name),l(ae,`#${e(n).reportedUser.id??""}`),l(se,C)},[()=>ge(e(n).reportedUser.id),()=>e(_).toLocaleString()]),Dt(r,()=>fs,()=>({duration:250})),b(i,r)});var ia=s(oa,2),Ha=t(ia);{var Ja=i=>{var n=Ms(),_=Z(n),$=t(_,!0);a(_);var r=s(_,2);r.__click=[Ss,D,g,f];var A=t(r);Ma(A,{class:"size-5"});var q=s(A);a(r),U((R,P)=>{l($,R),l(q,` ${P??""}`)},[()=>Kt(),()=>ps()]),b(i,n)},Ka=i=>{var n=Ze(),_=Z(n);{var $=r=>{var A=Ds();b(r,A)};T(_,r=>{e(d)&&e(f).length===0&&r($)},!0)}b(i,n)};T(Ha,i=>{!e(d)&&e(f).length===0?i(Ja):i(Ka,!1)})}a(ia),a(ke);var la=s(ke,2),Qa=t(la);{var Xa=i=>{var n=Ze(),_=Z(n);Pt(_,()=>e(g).id,$=>{const r=X(()=>e(g)),A=X(()=>{var v;return(v=ls(e(r).reports,o=>o.sameIpAccounts))==null?void 0:v.sameIpAccounts});var q=er(),R=Z(q),P=t(R),ze=t(P);a(P),a(R);var ee=s(R,2),ae=t(ee),te=t(ae);Qe(te,{class:"size-15",get userId(){return e(r).reportedUser.id},get pictureUrl(){return e(r).reportedUser.picture}});var se=s(te,2),re=t(se),ne=t(re),L=t(ne,!0);a(ne);var C=s(ne,2),oe=t(C),Za=t(oe,!0);a(oe);var Ae=s(oe,2),et=t(Ae);a(Ae);var ie=s(Ae,2);ie.__click=[Ps,r];var at=t(ie);Ba(at,{class:"inline size-4"}),a(ie);var ca=s(ie,2);{var tt=v=>{const o=X(()=>e(r).reportedUser.allianceId);var y=Ns();y.__click=[js,o];var z=t(y),B=s(z);Ba(B,{class:"size-3"}),a(y),U((j,N,E)=>{H(y,1,`tooltip badge badge-sm ml-0.5 border-0 ${j??""} ${N??""}`),G(y,"title",E),l(z,`${e(r).reportedUser.allianceName??""} `)},[()=>bs(e(o)),()=>ge(e(o)),()=>Ft({allianceId:e(o)})]),b(v,y)};T(ca,v=>{e(r).reportedUser.allianceId&&v(tt)})}var st=s(ca,2);{var rt=v=>{var o=Es();b(v,o)};T(st,v=>{e(r).reportedUser.paid&&v(rt)})}a(C);var nt=s(C,2);{var ot=v=>{Da(v,()=>e(r).reportedUser.role)};T(nt,v=>{e(r).reportedUser.role!=="user"&&v(ot)})}a(re);var da=s(re,2),Re=t(da),va=t(Re),_a=s(va),it=t(_a,!0);a(_a),a(Re);var pa=s(Re,2);{var lt=v=>{var o=Os(),y=Z(o),z=t(y),B=s(z),j=t(B,!0);a(B),a(y);var N=s(y,2),E=t(N),S=s(E),Be=t(S,!0);a(S),a(N),U((J,ue)=>{l(z,`${J??""}: `),l(j,e(r).reportedUser.timeoutCount),l(E,`${ue??""}: `),l(Be,F[e(r).reportedUser.lastTimeoutReason]??e(r).reportedUser.lastTimeoutReason)},[()=>cs(),()=>ds()]),b(v,o)};T(pa,v=>{e(r).reportedUser.lastTimeoutReason&&v(lt)})}var Le=s(pa,2),ua=t(Le),fa=s(ua),ct=t(fa,!0);a(fa),a(Le);var ma=s(Le,2),ba=t(ma),Ce=s(ba);let ga;var dt=t(Ce,!0);a(Ce),a(ma),a(da),a(se);var vt=s(se,2);{var _t=v=>{var o=Ws();o.__click=[Gs,ja,r];var y=t(o,!0);a(o),U(z=>{o.disabled=e(k),l(y,z)},[()=>ws()]),b(v,o)};T(vt,v=>{var o;((o=Ke.data)==null?void 0:o.role)==="admin"&&v(_t)})}a(ae);var xa=s(ae,4);He(xa,21,()=>e(r).reports,v=>v.id,(v,o)=>{const y=X(()=>`${Je.url.origin}/?lat=${e(o).reportedLatitude}&lng=${e(o).reportedLongitude}&select=true${e(o).zoom?`&zoom=${e(o).zoom}`:""}`),z=X(()=>{var m;return((m=Y[e(o).id])==null?void 0:m.showIframe)??!1});var B=Zs(),j=t(B),N=t(j),E=s(N),S=t(E);S.__click=[Vs,Na,r,o];var Be=t(S,!0);a(S);var J=s(S,2);J.__click=[Ys,Ea,r,o];var ue=t(J);Yt(ue,{class:"size-5"});var pt=s(ue);a(J);var ut=s(J,2);{var ft=m=>{var u=Fs();u.__click=[qs,Oa,r,o];var h=t(u);qt(h,{class:"size-5"});var K=s(h);a(u),U(O=>{u.disabled=e(k),l(K,` ${O??""}`)},[()=>Ts()]),b(m,u)};T(ut,m=>{var u,h;(((u=Ke.data)==null?void 0:u.role)==="admin"||((h=Ke.data)==null?void 0:h.role)==="global_moderator")&&m(ft)})}a(E),a(j);var Se=s(j,2),ha=t(Se);Qe(ha,{class:"size-15",get userId(){return e(o).reportedBy},get pictureUrl(){return e(o).reportedByPicture}});var ya=s(ha,2),Me=t(ya),ka=t(Me),De=s(ka),Pe=t(De),mt=t(Pe,!0);a(Pe);var wa=s(Pe,2),bt=t(wa);a(wa),a(De),a(Me);var $a=s(Me,2),je=t($a),Ne=t(je),gt=t(Ne);a(Ne);var fe=s(Ne,2);He(fe,21,()=>he,jt,(m,u)=>{var h=Hs(),K=t(h,!0);a(h);var O={};U(()=>{l(K,e(u).label),O!==(O=e(u).value)&&(h.value=(h.__value=e(u).value)??"")}),b(m,h)}),a(fe),a(je);var Ee=s(je,2),Ta=t(Ee),Ua=s(Ta),xt=t(Ua,!0);a(Ua),a(Ee);var Oe=s(Ee,2),Ia=t(Oe),Ge=s(Ia),ht=t(Ge);Xe(ht,{class:"inline size-4"}),qe(2),a(Ge),a(Oe);var za=s(Oe,2),Aa=t(za),We=s(Aa),yt=t(We);Xe(yt,{class:"inline size-4"}),qe(2),a(We),a(za),a($a),a(ya),a(Se);var Ra=s(Se,2);{var kt=m=>{var u=Js(),h=t(u),K=t(h,!0);a(h);var O=s(h,2),Ve=t(O,!0);a(O),a(u),U(Ye=>{l(K,Ye),l(Ve,e(o).notes)},[()=>Ht()]),b(m,u)};T(Ra,m=>{e(o).notes&&m(kt)})}var La=s(Ra,2),me=t(La),Ca=t(me),wt=s(Ca,2);Qt(wt,{class:"absolute left-1/2 top-1/2 size-7 -translate-x-1/2 -translate-y-[87%]"}),a(me);var $t=s(me,2);{var Tt=m=>{var u=Ks();U(()=>G(u,"src",e(y))),b(m,u)},Ut=m=>{var u=Xs();u.__click=[Qs,Y,o];var h=t(u);Xe(h,{class:"size-4"}),qe(),a(u),b(m,u)};T($t,m=>{e(z)?m(Tt):m(Ut,!1)})}a(La),a(B),U((m,u,h,K,O,Ve,Ye,It,zt,At)=>{l(N,`${m??""} #${e(o).id??""} `),S.disabled=e(k),l(Be,u),J.disabled=e(k),l(pt,` ${h??""}`),l(ka,`${K??""}: `),H(De,1,`font-semibold ${O??""}`),l(mt,e(o).reportedByName),l(bt,`#${e(o).reportedBy??""}`),l(gt,`${Ve??""}:`),H(fe,1,`select select-bordered select-sm font-semibold ${Wt[e(I)[e(o).id]]??""}`),l(Ta,`${Ye??""}: `),l(xt,It),l(Ia,`${zt??""}: `),G(Ge,"href",e(y)),l(Aa,`${At??""}: `),G(We,"href",`${Je.url.origin??""}/?lat=${e(o).lastPixelLatitude??""}&lng=${e(o).lastPixelLongitude??""}&select=true`),G(me,"href",e(y)),G(Ca,"src",e(o).imageUrl)},[()=>Xt(),()=>hs(),()=>us(),()=>Zt(),()=>ge(e(o).reportedBy),()=>es(),()=>as(),()=>new Date(e(o).createdAt).toLocaleString(),()=>ts(),()=>ss()]),Ot(fe,()=>e(I)[e(o).id],m=>e(I)[e(o).id]=m),b(v,B)}),a(xa),a(ee),U((v,o,y,z,B,j,N,E,S)=>{G(P,"title",e(r).id),l(ze,`${v??""}: ${o??""}`),l(L,y),H(C,1,`text-lg font-semibold ${z??""}`),l(Za,e(r).reportedUser.name),l(et,`#${e(r).reportedUser.id??""}`),G(ie,"title",B),l(va,`${j??""}: `),l(it,e(r).reportedUser.reportedCount),l(ua,`${N??""}: `),l(ct,e(r).reportedUser.pixelsPainted),l(ba,`${E??""}: `),ga=H(Ce,1,"font-semibold",null,ga,S),l(dt,e(A))},[()=>rs(),()=>e(r).id.split("-").at(-1),()=>Sa(),()=>ge(e(r).reportedUser.id),()=>ns({userId:e(r).reportedUser.id}),()=>os(),()=>Jt(),()=>is(),()=>({"text-red-600":e(A)>=7})]),b($,q)}),b(i,n)};T(Qa,i=>{e(g)&&i(Xa)})}a(la),a(ye),U((i,n,_)=>{G(_e,"href",Je.url.origin),l(Wa,i),l(Va,`${n??""}: ${e(ce)??""??""}`),l(sa,`Closed reports: ${e(V).rclosedTotal??""}`),l(ra,` Ignored: ${e(V).ignored??""}`),l(na,` Timeouts: ${e(V).timeouts??""}`),l(Ya,` Bans: ${e(V).bans??""}`),l(qa,` ${_??""}: ${e(V).closedTotal??""}`),pe.disabled=e(d)},[()=>Sa(),()=>ms(),()=>zs()]),b(p,ye),Bt()}Lt(["click"]);export{Tr as component};
